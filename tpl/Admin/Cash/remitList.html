<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8"> 
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <meta name="apple-mobile-web-app-capable" content="yes" />

        <!-- Base Css Files -->
        <link href="__PUBLIC__/statics/coco-chat/assets/libs/jqueryui/ui-lightness/jquery-ui-1.10.4.custom.min.css" rel="stylesheet" />
        <link href="__PUBLIC__/statics/coco-chat/assets/libs/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
        <link href="__PUBLIC__/statics/coco-chat/assets/libs/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
        <link href="__PUBLIC__/statics/coco-chat/assets/libs/fontello/css/fontello.css" rel="stylesheet" />
        <link href="__PUBLIC__/statics/coco-chat/assets/libs/animate-css/animate.min.css" rel="stylesheet" />
        <link href="__PUBLIC__/statics/coco-chat/assets/libs/nifty-modal/css/component.css" rel="stylesheet" />
        <link href="__PUBLIC__/statics/coco-chat/assets/libs/magnific-popup/magnific-popup.css" rel="stylesheet" /> 
        <link href="__PUBLIC__/statics/coco-chat/assets/css/style.css" rel="stylesheet" type="text/css" />
        <link href="__PUBLIC__/statics/coco-chat/assets/css/style-responsive.css" rel="stylesheet" />
        <link href="__PUBLIC__/statics/coco-chat/assets/libs/pace/pace.css" rel="stylesheet" />
        <link href="__PUBLIC__/statics/coco-chat/assets/libs/jquery-notifyjs/styles/metro/notify-metro.css" rel="stylesheet" type="text/css" />
        
        <!-- Extra CSS Files -->
      	<link href="__PUBLIC__/statics/coco-chat/assets/libs/bootstrap-select/bootstrap-select.min.css" rel="stylesheet" type="text/css" />
        
        <!-- Custom Css Files -->
        <link href="__ADMIN_CSS__/style.css"  rel="stylesheet" />
    </head>
    
    <body>
	<!-- Begin page -->
	<div>
        <div class="sub-header-title">
            <h2>汇款记录</h2>
        </div>
        <form method="post" class="form-horizontal" action="{:U('Cash/remitList')}">
       		<div class="form-group">
	         	<div class="col-sm-2">
	             	<select class="form-control selectpicker" id="status" name="status">
	                  	<option value="-1">全部状态</option>
	                  		<option value="0" <if condition="$status eq '0'">selected</if>>未处理</option>
	                  		<option value="1" <if condition="$status eq '1'">selected</if>>已通过</option>
	                  		<option value="2" <if condition="$status eq '2'">selected</if>>已驳回</option>
	                </select>
	            </div>
	  			<div class="col-sm-2">
	        		<div class="input-group">
                     	<span class="input-group-addon">日期</span>
                     	<input type="text" class="form-control" id="date-start" name="start_date" value="{$start_date}" placeholder="开始日期"/>
                 	</div>
	           	</div>
	          	<div class="col-sm-2">
             		<div class="input-group">
	                    <span class="input-group-addon">-</span>
	                  	<input type="text" class="form-control" id="data-end" name="end_date" value="{$end_date}" placeholder="截止日期"/>
	              	</div>
	       		</div>
	       		<div class="col-sm-2">
	               	<input class="form-control" placeholder="根据会员编号搜索" value="{$keyword}" id="keyword" name="keyword" type="text">
	            </div>
	            <div class="col-sm-2">
	                <button class="btn btn-success" type="submit">查询</button>
	            </div>
                <div class="col-sm-2">
                  	<button class="btn btn-success pull-right" id='export-excel' onclick="return false;">导出汇款记录</button>
              	</div>
	        </div>
        </form>
    </div>
    <div class="widget">
        <div class="widget-content">
        	<h4 class="form-group">
        		已汇款总计:<span class="total">{$currency_symbol}<if condition="$statistics.sum_total eq 0">0.00<else />{$statistics.sum_total}</if></span>
        	</h4>
           	<table class="table table-bordered table-striped">
                <thead>
                    <tr>
                    	<th>会员编号</th>
                    	<th>银行信息</th>
                    	<th>汇款金额</th>
                        <th>状态</th>
                        <th>备注</th>
                        <th>汇款日期</th>
                        <th>申请时间</th>
                        <th>处理时间</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody>
                	<volist name="list" id="vo">
	                 	<tr>
	                    	<td>{$vo.user_no}</td>
                      		<td>
                      			真实姓名：{$vo.name}<br/>
                      			银行:{$vo.bank}<br/>
                      			支行:{$vo.sub_bank}<br/>
                      			卡号:{$vo.bank_no}
                      		</td>
                      		<td>{$currency_symbol}{$vo.amount}</td>
	                        <td>
	                        	<switch name="vo.status">
							        <case value="0">未处理</case>
							        <case value="1">已同意</case>
							        <case value="2">已驳回</case>
							        <default />未知
							    </switch>
	                        </td>
	                        <td>{$vo.remark}</td>
	                        <td>{$vo.remit_date}</td>
	                        <td>{$vo.add_time}</td>
	                        <td>{$vo.operate_time}</td>
	                        <td ref="{$vo.id}">
	                        	<if condition="$vo['status'] eq 0">
	                        	<a class="confirm" href="javascript:;">同意</a> |
                              	<a class="reject" href="javascript:;">驳回</a>
                              	<else /> -
                                </if>
							</td>
	                 	</tr>
                 	</volist>
            	</tbody>
            </table>
            {$page}
        </div> 
    </div> 
    <!-- End of page -->
	
	<!-- Base Js Files -->
	<script src="__PUBLIC__/statics/coco-chat/assets/libs/jquery/jquery-1.11.1.min.js"></script>
	<script src="__PUBLIC__/statics/coco-chat/assets/libs/bootstrap/js/bootstrap.min.js"></script>
	<script src="__PUBLIC__/statics/coco-chat/assets/libs/jqueryui/jquery-ui-1.10.4.custom.min.js"></script>
	<script src="__PUBLIC__/statics/coco-chat/assets/libs/jquery-ui-touch/jquery.ui.touch-punch.min.js"></script>
 	<script src="__PUBLIC__/statics/coco-chat/assets/libs/jquery-detectmobile/detect.js"></script>
	<script src="__PUBLIC__/statics/coco-chat/assets/libs/fastclick/fastclick.js"></script>
	<script src="__PUBLIC__/statics/coco-chat/assets/libs/jquery-slimscroll/jquery.slimscroll.js"></script>
	<script src="__PUBLIC__/statics/coco-chat/assets/libs/nifty-modal/js/classie.js"></script>
	<script src="__PUBLIC__/statics/coco-chat/assets/libs/nifty-modal/js/modalEffects.js"></script>
	<script src="__PUBLIC__/statics/coco-chat/assets/libs/jquery-notifyjs/notify.min.js"></script>
    <script src="__PUBLIC__/statics/coco-chat/assets/libs/jquery-notifyjs/styles/metro/notify-metro-blue.js"></script>
	<script src="__PUBLIC__/statics/coco-chat/assets/libs/pace/pace.min.js"></script>
	
	<!-- Extra Js Files -->
	<script src="__PUBLIC__/statics/coco-chat/assets/libs/bootstrap-select/bootstrap-select.min.js"></script>
    <script src="__PUBLIC__/statics/coco-chat/assets/libs/bootstrap-select2/select2.min.js"></script>
    <script src="__PUBLIC__/statics/coco-chat/assets/libs/laydate/laydate.js"></script>
	
	<!-- Custom Js Files -->
	<script src="__ADMIN_JS__/common.js"></script>
	
    <script>
    	var start = {
   		  	elem: '#date-start', //目标元素。由于laydate.js封装了一个轻量级的选择器引擎，因此elem还允许你传入class、tag但必须按照这种方式 '#id .class'
   		 	event: 'focus', //响应事件。如果没有传入event，则按照默认的click
   		 	max: laydate.now(), //最大日期
   		  	choose: function(datas){
   		     	end.min = datas; //开始日选好后，重置结束日的最小日期
   		     	end.start = datas //将结束日的初始值设定为开始日
   		  	}
   		};
   		var end = {
   		  	elem: '#data-end', //目标元素。由于laydate.js封装了一个轻量级的选择器引擎，因此elem还允许你传入class、tag但必须按照这种方式 '#id .class'
   		 	event: 'focus', //响应事件。如果没有传入event，则按照默认的click
   		 	max: laydate.now(), //最大日期
   		  	choose: function(datas){
   		    	start.max = datas; //结束日选好后，重置开始日的最大日期
   		  	}
   		};
   		laydate(start);
   		laydate(end);

   		//SELECT
		$('.selectpicker').selectpicker();
	
		//绑定审核确认事件
		$(".confirm").click(function(event) {
	    	var id = $(this).parent('td').attr("ref");
	    	
	    	//询问框
			window.parent.layer.confirm('操作后将无法恢复，确认同意此汇款吗？', {
				btn: ['确认','取消'], //按钮
			}, function(index){
				// 用ajax提交表单
		      	$.post("{:U('Cash/confirmRemit')}", "id="+id, function(response) {
		      		//弹出提示
					window.parent.layer.msg(response.message);
		      		
		      		//根据请求相应状态提示通知
		       		if(response.status){
		       			notify("success",response.message);
						window.location.reload();
					}else{
						notify("error",response.message);
					}
		        }, 'json');
		      	window.parent.layer.close(index);
			});
	    }); 
		
		//绑定审核驳回事件
		$(".reject").click(function(event) {
	    	var id = $(this).parent('td').attr("ref");
	    	
	    	//询问框
			window.parent.layer.confirm('操作后将无法恢复，确认驳回此汇款吗？', {
				btn: ['确认','取消'], //按钮
			}, function(index){
				// 用ajax提交表单
		      	$.post("{:U('Cash/rejectRemit')}", "id="+id, function(response) {
		      		//弹出提示
					window.parent.layer.msg(response.message);
		      		
		      		//根据请求相应状态提示通知
		       		if(response.status){
		       			notify("success",response.message);
						window.location.reload();
					}else{
						notify("error",response.message);
					}
		        }, 'json');
		      	window.parent.layer.close(index);
			});
	    }); 

	    //导出excel
        $('#export-excel').click(function(){
          var data = 'status=' + $('#status').val() + "&";
              data += 'date_start=' + $('#date-start').val() + '&';
              data += 'date_end=' + $('#data-end').val() + '&';
              data += 'keyword=' + $('#keyword').val() + '&';

          window.parent.layer.confirm('确认导出所有数据？',{
            btn: ['确认','取消'], //按钮
          },function(index){
               window.open("{:U('Cash/exportRemitExcel')}"+"?"+data);
               window.parent.layer.close(index);
          });
        });
	</script>
	</body>
</html>
